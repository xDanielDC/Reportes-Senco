import{_ as F}from"./AppLayout-1872c1d6.js";import{_ as $}from"./TextInput-67026b5f.js";import{_ as E}from"./Checkbox-4f738b6a.js";import{_ as P}from"./InputLabel-8586db4c.js";import{u as N,a as C,e as O,r as M,m as k}from"./i18n-validators-63d8612e.js";import{_ as S,i as D,k as T,a0 as R,I as h,o as t,c as j,w as d,a as s,t as m,b as r,f as x,n as y,e as o,F as f,g as p,h as g}from"./app-e23bdcff.js";import{_ as G}from"./CustomButton-9f2275fd.js";import{a as H}from"./DialogModal-ba4ec678.js";import{_ as J}from"./SecondaryButton-4187b912.js";import{_ as K}from"./PrimaryButton-53fc1b09.js";import Q from"./Index-546461a9.js";const W={computed:{report(){return Q}},setup(){return{v$:N()}},components:{PrimaryButton:K,SecondaryButton:J,DialogModal:H,FontAwesomeIcon:D,CustomButton:G,Link:T,InputLabel:P,Checkbox:E,TextInput:$,AppLayout:F},props:{user:Object,roles:Array,permissions:Array,reports:Array,filters:Array},validations(){return{form:{id:{required:C},name:{required:C},username:{required:C},email:{required:C,email:O},password:{requiredIf:M(this.form.change_password),minLength:k(8)},confirm_password:{requiredIf:M(this.form.change_password),minLength:k(8)},reports:{minLength:k(1)},permissions:{requiredIf:M(this.form.roles.length<1),minLength:k(1)},roles:{requiredIf:M(this.form.permissions.length<1),minLength:k(1)}}}},data(){return{form:{id:this.user.id,type:this.user.type,name:this.user.name,username:this.user.username,email:this.user.email,change_password:!1,password:"",reports:[],permissions:this.user.permissions.map(n=>n.name),roles:this.user.roles.map(n=>n.name)},filterModal:{open:!1,form:{user_id:"",report_id:"",filters:[]}},reportModal:{open:!1,form:{user_id:"",reports:[]}}}},methods:{openFilterModal(n,l){this.filterModal={open:!0,form:{user_id:this.user.id,report_id:n,filters:l.map(u=>u.id)}}},closeModal(){this.filterModal={open:!1,form:{user_id:"",report_id:"",filters:[]}},this.reportModal={open:!1,form:{user_id:"",reports:[]}}},updateFilter(){axios.post(route("user.report.update-filters"),this.filterModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Filtros actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),R.visit(route("users.edit",this.user.id))}).catch(n=>{this.$swal({icon:"error",title:"ERROR",text:n.response.data})})},openReportModal(){this.reportModal={open:!0,form:{user_id:this.user.id,reports:this.user.reports.map(n=>n.id)}}},updateReports(){axios.post(route("user.update-reports"),this.reportModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reportes actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),R.visit(route("users.edit",this.user.id))}).catch(n=>{this.$swal({icon:"error",title:"ERROR",text:n.response.data})})},updateUser(){this.v$.form.$touch(),this.v$.form.$invalid?this.$swal({icon:"error",title:"ERROR",text:"Verifica que toda la información este correctamente diligenciada"}):axios.put(route("users.update",this.form.id),this.form).then(()=>{this.$swal({icon:"success",title:"Usuario Actualizado",text:"Usuario actualizado con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),R.visit(route("users.edit",this.user.id))}).catch(n=>{this.$swal({icon:"error",title:"ERROR",text:n.response.data})})},updateShowDashboard(n,l){axios.post(route("user.report.set-default"),{user_id:this.user.id,report_id:n,state:l}).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reporte actualizado con exito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),R.visit(route("users.edit",this.user.id))}).catch(u=>{this.$swal({icon:"error",title:"ERROR",text:u.response.data})})}}},X={class:"flex flex-row"},Y={class:"font-semibold text-xl text-gray-800 leading-tight"},Z={class:"py-10"},ee={class:"max-w-8xl mx-10 sm:px-8 lg:px-8"},se={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},te={class:"py-2 align-middle inline-block min-w-full"},oe={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg bg-white p-5"},re={class:"grid grid-cols-3 gap-5"},ie={key:0,class:"mt-1"},le={key:0,class:"mt-1"},ae={key:0,class:"mt-1"},ne={class:"block"},de={class:"flex items-center"},ce=s("span",{class:"ml-2 text-sm text-gray-600"},"Cambiar contraseña",-1),me={key:0},ue={key:0,class:"mt-1"},fe={class:"border rounded-lg p-4 col-span-3"},pe=s("legend",null,"Roles disponibles",-1),_e={class:"grid grid-cols-5 gap-5"},he={class:"flex items-center"},xe={class:"ml-2"},ge={key:0,class:"mt-1"},ve={class:"border rounded-lg p-4 col-span-3"},ke=s("legend",null,"Permisos disponibles",-1),ye={class:"grid grid-cols-5 gap-5"},we={class:"flex items-center"},be={class:"ml-2"},Ce={key:0,class:"mt-1"},Me={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg mt-5 bg-white"},Re={class:"min-w-full divide-y divide-gray-200"},Be={class:"bg-gray-50"},Ve=s("tr",{class:"border-b"},[s("th",{scope:"col",colspan:"4",class:"px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"}," Reportes ")],-1),Ae={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Le=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Mostrar en dashboard ",-1),Ue=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Reporte ",-1),Ie=s("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Filtros ",-1),qe={class:"bg-white divide-y divide-gray-200"},ze={class:"px-6 py-4 text-center text-sm font-medium"},Fe={class:"flex flex-row"},$e={class:"px-6 py-4 text-left text-sm font-medium"},Ee={class:"px-6 py-4 text-left text-sm font-medium"},Pe={class:"px-6 py-4 text-left text-sm font-medium"},Ne={key:1,class:"text-xs font-semibold inline-block py-1 px-2 rounded text-red-600 bg-red-200 uppercase last:mr-0 mr-1"},Oe={key:1},Se=s("td",{class:"px-6 py-4 text-sm font-medium text-center text-red-500",colspan:"4"}," Ningún registro agregado… ",-1),De=[Se],Te={class:"grid grid-cols-2 gap-5"},je={class:"flex items-center"},Ge={class:"ml-2"},He={class:"grid grid-cols-2 gap-5"},Je={class:"flex items-center"},Ke={class:"ml-2"};function Qe(n,l,u,c,a,_){const B=h("font-awesome-icon"),I=h("Link"),w=h("InputLabel"),b=h("TextInput"),v=h("Checkbox"),V=h("PrimaryButton"),A=h("CustomButton"),L=h("SecondaryButton"),U=h("DialogModal"),q=h("AppLayout");return t(),j(q,{title:`Editar usuario ${u.user.name}`},{header:d(()=>[s("div",X,[s("h2",Y," Editar usuario "+m(u.user.name),1)])]),actions:d(()=>[r(I,{href:n.route("users.index"),class:"inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150"},{default:d(()=>[r(B,{class:"mr-2",icon:"arrow-left"}),x(" Atrás ")]),_:1},8,["href"])]),default:d(()=>[s("div",Z,[s("div",ee,[s("div",se,[s("div",te,[s("div",oe,[s("div",re,[s("div",null,[r(w,{value:"Nombre"}),r(b,{modelValue:a.form.name,"onUpdate:modelValue":l[0]||(l[0]=e=>a.form.name=e),type:"text",class:y(["mt-1 block w-full",{"border-red-500":c.v$.form.name.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),c.v$.form.name.$error?(t(),o("ul",ie,[(t(!0),o(f,null,p(c.v$.form.name.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(w,{value:"Usuario"}),r(b,{modelValue:a.form.username,"onUpdate:modelValue":l[1]||(l[1]=e=>a.form.username=e),type:"text",class:y(["mt-1 block w-full",{"border-red-500":c.v$.form.username.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),c.v$.form.username.$error?(t(),o("ul",le,[(t(!0),o(f,null,p(c.v$.form.username.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("div",null,[r(w,{value:"Correo electrónico"}),r(b,{modelValue:a.form.email,"onUpdate:modelValue":l[2]||(l[2]=e=>a.form.email=e),type:"email",class:y(["mt-1 block w-full",{"border-red-500":c.v$.form.email.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),c.v$.form.email.$error?(t(),o("ul",ae,[(t(!0),o(f,null,p(c.v$.form.email.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("div",ne,[s("label",de,[r(v,{checked:a.form.change_password,"onUpdate:checked":l[3]||(l[3]=e=>a.form.change_password=e),name:"change_password"},null,8,["checked"]),ce])]),a.form.change_password?(t(),o("div",me,[r(w,{value:"Contraseña"}),r(b,{modelValue:a.form.password,"onUpdate:modelValue":l[4]||(l[4]=e=>a.form.password=e),type:"password",class:y(["mt-1 block w-full",{"border-red-500":c.v$.form.password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),c.v$.form.password.$error?(t(),o("ul",ue,[(t(!0),o(f,null,p(c.v$.form.password.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)])):g("",!0),s("fieldset",fe,[pe,s("div",_e,[(t(!0),o(f,null,p(u.roles,e=>(t(),o("div",he,[r(v,{checked:a.form.roles,"onUpdate:checked":l[5]||(l[5]=i=>a.form.roles=i),value:e.name},null,8,["checked","value"]),s("div",xe,m(e.name),1)]))),256))]),c.v$.form.roles.$error?(t(),o("ul",ge,[(t(!0),o(f,null,p(c.v$.form.roles.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)]),s("fieldset",ve,[ke,s("div",ye,[(t(!0),o(f,null,p(u.permissions,e=>(t(),o("div",we,[r(v,{checked:a.form.permissions,"onUpdate:checked":l[6]||(l[6]=i=>a.form.permissions=i),value:e.name},null,8,["checked","value"]),s("div",be,m(e.name),1)]))),256))]),c.v$.form.permissions.$error?(t(),o("ul",Ce,[(t(!0),o(f,null,p(c.v$.form.permissions.$errors,(e,i)=>(t(),o("li",{class:"text-red-500",key:i},m(e.$message),1))),128))])):g("",!0)])]),r(V,{onClick:_.updateUser,class:"mt-5"},{default:d(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),s("div",Me,[s("table",Re,[s("thead",Be,[Ve,s("tr",null,[s("th",Ae,[r(A,{class:"mr-2",onClick:_.openReportModal},{default:d(()=>[r(B,{icon:["far","pen-to-square"],class:"mr-1"}),x(" Modificar reportes ")]),_:1},8,["onClick"])]),Le,Ue,Ie])]),s("tbody",qe,[u.user.reports.length>0?(t(!0),o(f,{key:0},p(u.user.reports,e=>(t(),o("tr",null,[s("td",ze,[s("div",Fe,[r(A,{class:"mr-2",onClick:i=>_.openFilterModal(e.id,e.filters)},{default:d(()=>[r(B,{icon:["fas","filter"],class:"mr-1"}),x(" Filtros ")]),_:2},1032,["onClick"])])]),s("td",$e,[r(v,{onChange:i=>_.updateShowDashboard(e.id,!e.pivot.show),value:e.pivot.show,checked:e.pivot.show===1},null,8,["onChange","value","checked"])]),s("td",Ee,m(e.name),1),s("td",Pe,[e.filters.length>0?(t(!0),o(f,{key:0},p(e.filters,(i,z)=>(t(),o("span",{class:y(["text-xs font-semibold inline-block py-1 px-2 rounded text-green-600 bg-green-200 uppercase last:mr-0 mr-1",{"ml-1":z>0}])},m(i.name),3))),256)):(t(),o("span",Ne," Ningún filtro agregado "))])]))),256)):(t(),o("tr",Oe,De))])])])])])])]),r(U,{show:a.filterModal.open,onClose:_.closeModal},{title:d(()=>[x(" Filtros "+m(u.reports.find(e=>e.id===a.filterModal.form.report_id).name),1)]),content:d(()=>[s("div",Te,[(t(!0),o(f,null,p(u.filters,e=>(t(),o("div",je,[r(v,{checked:a.filterModal.form.filters,"onUpdate:checked":l[7]||(l[7]=i=>a.filterModal.form.filters=i),value:e.id},null,8,["checked","value"]),s("div",Ge,m(e.name),1)]))),256))])]),footer:d(()=>[r(L,{onClick:_.closeModal},{default:d(()=>[x(" Cancelar ")]),_:1},8,["onClick"]),r(V,{class:"ml-3",onClick:_.updateFilter},{default:d(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),_:1},8,["show","onClose"]),r(U,{show:a.reportModal.open,onClose:_.closeModal},{title:d(()=>[x(" Modificar reportes ")]),content:d(()=>[s("div",He,[(t(!0),o(f,null,p(u.reports,e=>(t(),o("div",Je,[r(v,{checked:a.reportModal.form.reports,"onUpdate:checked":l[8]||(l[8]=i=>a.reportModal.form.reports=i),value:e.id},null,8,["checked","value"]),s("div",Ke,m(e.name),1)]))),256))])]),footer:d(()=>[r(L,{onClick:_.closeModal},{default:d(()=>[x(" Cancelar ")]),_:1},8,["onClick"]),r(V,{class:"ml-3",onClick:_.updateReports},{default:d(()=>[x(" Actualizar ")]),_:1},8,["onClick"])]),_:1},8,["show","onClose"])]),_:1},8,["title"])}const as=S(W,[["render",Qe]]);export{as as default};
