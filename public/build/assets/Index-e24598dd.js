import{p as T,a2 as y,I as k,o as l,c as R,w as a,a as e,b as r,u as m,i as C,f as p,t as c,e as i,g,D as S,$ as U,n as L,F as x,h as $,a5 as v}from"./app-f1fb3b10.js";import{_ as B}from"./AppLayout-ae53a7bb.js";import{_ as b}from"./CustomButton-58efdc54.js";import{a as w,m as Y,h as D,u as P}from"./i18n-validators-307ee24b.js";import{_ as F}from"./PrimaryButton-ae7b5b9e.js";import{a as q}from"./DialogModal-0a95c594.js";import{_ as W}from"./Checkbox-19abc708.js";import{_ as z}from"./SecondaryButton-f0719638.js";import{L as G}from"./Main-3577b8d4.js";const K=e("div",{class:"flex flex-row"},[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Ordenes de compra ")],-1),Q={class:"py-10"},j={class:"max-w-8xl sm:px-4 lg:px-6"},H={class:"text-center"},J={class:"overflow-y-auto"},X={class:"table table-sm table-bordered"},Z=e("thead",null,[e("tr",{class:"text-center"},[e("th",{colspan:"3",class:"border-b"}," Producto "),e("th",{colspan:"4",class:"border-b"}," Cantidades "),e("th",{class:"border-b",rowspan:"2"}," Fecha entrega ")]),e("tr",null,[e("th"),e("th",null,"Código"),e("th",null,"Descripción"),e("th",null,"Solicitada"),e("th",null,"Entregada"),e("th",null,"Pendiente"),e("th",null,"Compromiso")])],-1),ee={class:"text-right"},te={class:"text-right"},oe={class:"text-right"},se=["onUpdate:modelValue"],ae={key:0,class:"mt-1"},re={key:0,class:"mt-1"},fe={__name:"Index",props:{orders:Array},setup(O){const _=T({data:O.orders,columns:["oc","name","document","actions"],options:{headings:{oc:"OC",name:"PROVEEDOR",document:"NIT",actions:""},clientSorting:!1,uniqueKey:"id",sortable:["oc","name","document"]}}),s=T({open:!1,row:{}}),N=T({row:{registries:{required:w,minLength:Y(1),$each:D.forEach({DELIVERY_DATE:{required:w},COMMITTED_AMOUNT:{required:w,minValue:D.withMessage(()=>"No puede ser menor o igual a 0",o=>0<=o),maxValue:D.withMessage(()=>"No puede ser mayor a la cantidad pendiente",(o,{PENDING_AMOUNT:h})=>o<=h)}})}}}),M=()=>{s.open=!1,s.row={}},A=o=>{s.open=!0,s.row=o},d=P(N,y(s)),V=()=>{d.value.$touch(),d.value.$invalid||!s.row.registries.some(o=>o.SELECTED===!0)?Swal.fire({icon:"error",title:"¡Whoops!",text:"Verifica que toda la información este correctamente diligenciada",confirmButtonText:"Aceptar"}):(v.Loading(),axios.post(route("supplier-delivery.update"),s.row).then(o=>{_.data=o.data,Swal.fire({icon:"error",title:"¡Éxito!",text:"Registro actualizado con éxito",confirmButtonText:"Aceptar"})}).catch(o=>{Swal.fire({icon:"error",title:"¡Whoops!",text:o.response.data,confirmButtonText:"Aceptar"})}))},I=o=>{Swal.fire({icon:"question",title:"¿Enviar Notificación?",text:"Se le enviara una notificación al proveedor para que confirme la cantidad y fecha de entrega",showCancelButton:!0,confirmButtonText:"¡Si, Enviar!",cancelButtonText:"Cancelar"}).then(h=>{h.isConfirmed&&(v.Loading(),axios.post(route("supplier-delivery.send-mail"),o).then(f=>{Swal.fire({icon:"success",title:"¡Éxito!",text:"Notificación enviada con éxito",confirmButtonText:"Aceptar"})}).catch(f=>{Swal.fire({icon:"error",title:"Error",text:f.response.data})}))})};return(o,h)=>{const f=k("v-client-table");return l(),R(B,{title:"Ordenes de compra"},{header:a(()=>[K]),default:a(()=>[e("div",Q,[e("div",j,[r(f,{columns:_.columns,data:_.data,options:_.options,class:"overflow-y-auto w-full"},{actions:a(({row:t})=>[e("div",H,[r(b,{type:"button",onClick:u=>A(t)},{default:a(()=>[r(m(C),{class:"mr-2",icon:"plus"}),p(" Registrar entrega ")]),_:2},1032,["onClick"]),r(b,{type:"button",class:"ml-2",onClick:u=>I(t)},{default:a(()=>[r(m(C),{class:"mr-2",icon:"envelope"}),p(" Enviar Notificación ")]),_:2},1032,["onClick"])])]),_:1},8,["columns","data","options"]),r(q,{show:s.open,onClose:M,"max-width":"7xl"},{title:a(()=>[p(" ORDEN DE COMPRA #"+c(s.row.oc),1)]),content:a(()=>[e("div",J,[e("table",X,[Z,e("tbody",null,[(l(!0),i(x,null,g(s.row.registries,(t,u)=>(l(),i("tr",null,[e("td",null,[r(W,{checked:t.SELECTED,"onUpdate:checked":n=>t.SELECTED=n,name:"remember"},null,8,["checked","onUpdate:checked"])]),e("td",null,c(t.ITEM),1),e("td",null,c(t.PRODUCT_DESCRIPTION)+" – "+c(t.MEASUREMENT),1),e("td",ee,c(parseFloat(t.REQUESTED_AMOUNT)),1),e("td",te,c(parseFloat(t.RECEIVED_AMOUNT)),1),e("td",oe,c(parseFloat(t.PENDING_AMOUNT)),1),e("td",null,[S(e("input",{type:"number",class:L(["form-control form-control-sm",{"border-red-500":m(d).row.registries.$each.$response.$errors[u].COMMITTED_AMOUNT.length>0}]),"onUpdate:modelValue":n=>t.COMMITTED_AMOUNT=n},null,10,se),[[U,t.COMMITTED_AMOUNT]]),m(d).row.registries.$each.$response.$errors[u].COMMITTED_AMOUNT.length>0?(l(),i("ul",ae,[(l(!0),i(x,null,g(m(d).row.registries.$each.$response.$errors[u].COMMITTED_AMOUNT,(n,E)=>(l(),i("li",{key:E,class:"text-red-600"},c(n.$message),1))),128))])):$("",!0)]),e("td",null,[r(G,{modelValue:t.DELIVERY_DATE,"onUpdate:modelValue":n=>t.DELIVERY_DATE=n,options:{autoApply:!0,singleMode:!0,numberOfColumns:1,numberOfMonths:1,showWeekNumbers:!0,format:"DD-MM-YYYY",lang:"es-ES",minDate:t.DELIVERY_DATE},class:"form-control form-control-sm"},null,8,["modelValue","onUpdate:modelValue","options"]),m(d).row.registries.$each.$response.$errors[u].DELIVERY_DATE.length>0?(l(),i("ul",re,[(l(!0),i(x,null,g(m(d).row.registries.$each.$response.$errors[u].DELIVERY_DATE,(n,E)=>(l(),i("li",{key:E,class:"text-red-600"},c(n.$message),1))),128))])):$("",!0)])]))),256))])])])]),footer:a(()=>[r(z,{onClick:M},{default:a(()=>[p(" Cancelar ")]),_:1}),r(F,{class:"ml-3",onClick:V},{default:a(()=>[p(" Guardar ")]),_:1})]),_:1},8,["show"])])])]),_:1})}}};export{fe as default};
