import{p as T,a3 as I,L as k,o as i,c as R,w as r,a as e,b as n,u as p,i as C,f,t as c,e as d,g,H as S,a0 as U,n as L,F as x,h as $,a6 as v}from"./app-8631d0ed.js";import{_ as B}from"./AppLayout-deca06e6.js";import{_ as b}from"./CustomButton-4ddc4f19.js";import{a as w,m as Y,h as M,u as P}from"./i18n-validators-bc3fab5c.js";import{_ as F}from"./PrimaryButton-9f83ec13.js";import{a as q}from"./DialogModal-cfec345b.js";import{_ as W}from"./Checkbox-41e6bf30.js";import{_ as z}from"./SecondaryButton-641ff84c.js";import{L as G}from"./Main-221fbb65.js";const H={class:"py-10"},K={class:"max-w-8xl sm:px-4 lg:px-6"},Q={class:"text-center"},j={class:"overflow-y-auto"},J={class:"table table-sm table-bordered"},X={class:"text-right"},Z={class:"text-right"},ee={class:"text-right"},te=["onUpdate:modelValue"],oe={key:0,class:"mt-1"},se={key:0,class:"mt-1"},fe={__name:"Index",props:{orders:Array},setup(O){const _=T({data:O.orders,columns:["oc","name","document","actions"],options:{headings:{oc:"OC",name:"PROVEEDOR",document:"NIT",actions:""},clientSorting:!1,uniqueKey:"id",sortable:["oc","name","document"]}}),a=T({open:!1,row:{}}),N=T({row:{registries:{required:w,minLength:Y(1),$each:M.forEach({DELIVERY_DATE:{required:w},COMMITTED_AMOUNT:{required:w,minValue:M.withMessage(()=>"No puede ser menor o igual a 0",s=>0<=s),maxValue:M.withMessage(()=>"No puede ser mayor a la cantidad pendiente",(s,{PENDING_AMOUNT:t})=>s<=t)}})}}}),D=()=>{a.open=!1,a.row={}},A=s=>{a.open=!0,a.row=s},u=P(N,I(a)),V=()=>{u.value.$touch(),u.value.$invalid||!a.row.registries.some(s=>s.SELECTED===!0)?Swal.fire({icon:"error",title:"¡Whoops!",text:"Verifica que toda la información este correctamente diligenciada",confirmButtonText:"Aceptar"}):(v.Loading(),axios.post(route("supplier-delivery.update"),a.row).then(s=>{_.data=s.data,Swal.fire({icon:"error",title:"¡Éxito!",text:"Registro actualizado con éxito",confirmButtonText:"Aceptar"})}).catch(s=>{Swal.fire({icon:"error",title:"¡Whoops!",text:s.response.data,confirmButtonText:"Aceptar"})}))},y=s=>{Swal.fire({icon:"question",title:"¿Enviar Notificación?",text:"Se le enviara una notificación al proveedor para que confirme la cantidad y fecha de entrega",showCancelButton:!0,confirmButtonText:"¡Si, Enviar!",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&(v.Loading(),axios.post(route("supplier-delivery.send-mail"),s).then(h=>{Swal.fire({icon:"success",title:"¡Éxito!",text:"Notificación enviada con éxito",confirmButtonText:"Aceptar"})}).catch(h=>{Swal.fire({icon:"error",title:"Error",text:h.response.data})}))})};return(s,t)=>{const h=k("v-client-table");return i(),R(B,{title:"Ordenes de compra"},{header:r(()=>[...t[0]||(t[0]=[e("div",{class:"flex flex-row"},[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Ordenes de compra ")],-1)])]),default:r(()=>[e("div",H,[e("div",K,[n(h,{columns:_.columns,data:_.data,options:_.options,class:"overflow-y-auto w-full"},{actions:r(({row:o})=>[e("div",Q,[n(b,{type:"button",onClick:m=>A(o)},{default:r(()=>[n(p(C),{class:"mr-2",icon:"plus"}),t[1]||(t[1]=f(" Registrar entrega ",-1))]),_:1},8,["onClick"]),n(b,{type:"button",class:"ml-2",onClick:m=>y(o)},{default:r(()=>[n(p(C),{class:"mr-2",icon:"envelope"}),t[2]||(t[2]=f(" Enviar Notificación ",-1))]),_:1},8,["onClick"])])]),_:1},8,["columns","data","options"]),n(q,{show:a.open,onClose:D,"max-width":"7xl"},{title:r(()=>[f(" ORDEN DE COMPRA #"+c(a.row.oc),1)]),content:r(()=>[e("div",j,[e("table",J,[t[3]||(t[3]=e("thead",null,[e("tr",{class:"text-center"},[e("th",{colspan:"3",class:"border-b"}," Producto "),e("th",{colspan:"4",class:"border-b"}," Cantidades "),e("th",{class:"border-b",rowspan:"2"}," Fecha entrega ")]),e("tr",null,[e("th"),e("th",null,"Código"),e("th",null,"Descripción"),e("th",null,"Solicitada"),e("th",null,"Entregada"),e("th",null,"Pendiente"),e("th",null,"Compromiso")])],-1)),e("tbody",null,[(i(!0),d(x,null,g(a.row.registries,(o,m)=>(i(),d("tr",null,[e("td",null,[n(W,{checked:o.SELECTED,"onUpdate:checked":l=>o.SELECTED=l,name:"remember"},null,8,["checked","onUpdate:checked"])]),e("td",null,c(o.ITEM),1),e("td",null,c(o.PRODUCT_DESCRIPTION)+" – "+c(o.MEASUREMENT),1),e("td",X,c(parseFloat(o.REQUESTED_AMOUNT)),1),e("td",Z,c(parseFloat(o.RECEIVED_AMOUNT)),1),e("td",ee,c(parseFloat(o.PENDING_AMOUNT)),1),e("td",null,[S(e("input",{type:"number",class:L(["form-control form-control-sm",{"border-red-500":p(u).row.registries.$each.$response.$errors[m].COMMITTED_AMOUNT.length>0}]),"onUpdate:modelValue":l=>o.COMMITTED_AMOUNT=l},null,10,te),[[U,o.COMMITTED_AMOUNT]]),p(u).row.registries.$each.$response.$errors[m].COMMITTED_AMOUNT.length>0?(i(),d("ul",oe,[(i(!0),d(x,null,g(p(u).row.registries.$each.$response.$errors[m].COMMITTED_AMOUNT,(l,E)=>(i(),d("li",{key:E,class:"text-red-600"},c(l.$message),1))),128))])):$("",!0)]),e("td",null,[n(G,{modelValue:o.DELIVERY_DATE,"onUpdate:modelValue":l=>o.DELIVERY_DATE=l,options:{autoApply:!0,singleMode:!0,numberOfColumns:1,numberOfMonths:1,showWeekNumbers:!0,format:"DD-MM-YYYY",lang:"es-ES",minDate:o.DELIVERY_DATE},class:"form-control form-control-sm"},null,8,["modelValue","onUpdate:modelValue","options"]),p(u).row.registries.$each.$response.$errors[m].DELIVERY_DATE.length>0?(i(),d("ul",se,[(i(!0),d(x,null,g(p(u).row.registries.$each.$response.$errors[m].DELIVERY_DATE,(l,E)=>(i(),d("li",{key:E,class:"text-red-600"},c(l.$message),1))),128))])):$("",!0)])]))),256))])])])]),footer:r(()=>[n(z,{onClick:D},{default:r(()=>[...t[4]||(t[4]=[f(" Cancelar ",-1)])]),_:1}),n(F,{class:"ml-3",onClick:V},{default:r(()=>[...t[5]||(t[5]=[f(" Guardar ",-1)])]),_:1})]),_:1},8,["show"])])])]),_:1})}}};export{fe as default};
