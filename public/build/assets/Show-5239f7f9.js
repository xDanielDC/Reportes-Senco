import{_ as I}from"./AppLayout-deca06e6.js";import{_ as F}from"./TextInput-c4d1940e.js";import{_ as E}from"./Checkbox-41e6bf30.js";import{_ as N}from"./InputLabel-7ab20a25.js";import{u as P,a as C,e as S,r as M,m as b}from"./i18n-validators-bc3fab5c.js";import{_ as D,i as O,k as T,a1 as R,L as h,o,c as j,w as m,a as t,t as u,b as l,f as x,n as w,e as r,F as c,g as p,h as g}from"./app-8631d0ed.js";import{_ as G}from"./CustomButton-4ddc4f19.js";import{a as H}from"./DialogModal-cfec345b.js";import{_ as J}from"./SecondaryButton-641ff84c.js";import{_ as K}from"./PrimaryButton-9f83ec13.js";import Q from"./Index-6df7f918.js";const W={computed:{report(){return Q}},setup(){return{v$:P()}},components:{PrimaryButton:K,SecondaryButton:J,DialogModal:H,FontAwesomeIcon:O,CustomButton:G,Link:T,InputLabel:N,Checkbox:E,TextInput:F,AppLayout:I},props:{user:Object,roles:Array,permissions:Array,reports:Array,filters:Array},validations(){return{form:{id:{required:C},name:{required:C},username:{required:C},email:{required:C,email:S},password:{requiredIf:M(this.form.change_password),minLength:b(8)},confirm_password:{requiredIf:M(this.form.change_password),minLength:b(8)},reports:{minLength:b(1)},permissions:{requiredIf:M(this.form.roles.length<1),minLength:b(1)},roles:{requiredIf:M(this.form.permissions.length<1),minLength:b(1)}}}},data(){return{form:{id:this.user.id,type:this.user.type,name:this.user.name,username:this.user.username,email:this.user.email,change_password:!1,password:"",reports:[],permissions:this.user.permissions.map(d=>d.name),roles:this.user.roles.map(d=>d.name)},filterModal:{open:!1,form:{user_id:"",report_id:"",filters:[]}},reportModal:{open:!1,form:{user_id:"",reports:[]}}}},methods:{openFilterModal(d,e){this.filterModal={open:!0,form:{user_id:this.user.id,report_id:d,filters:e.map(f=>f.id)}}},closeModal(){this.filterModal={open:!1,form:{user_id:"",report_id:"",filters:[]}},this.reportModal={open:!1,form:{user_id:"",reports:[]}}},updateFilter(){axios.post(route("user.report.update-filters"),this.filterModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Filtros actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),R.visit(route("users.edit",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},openReportModal(){this.reportModal={open:!0,form:{user_id:this.user.id,reports:this.user.reports.map(d=>d.id)}}},updateReports(){axios.post(route("user.update-reports"),this.reportModal.form).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reportes actualizados con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),this.closeModal(),R.visit(route("users.edit",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},updateUser(){this.v$.form.$touch(),this.v$.form.$invalid?this.$swal({icon:"error",title:"ERROR",text:"Verifica que toda la información este correctamente diligenciada"}):axios.put(route("users.update",this.form.id),this.form).then(()=>{this.$swal({icon:"success",title:"Usuario Actualizado",text:"Usuario actualizado con éxito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),R.visit(route("users.edit",this.user.id))}).catch(d=>{this.$swal({icon:"error",title:"ERROR",text:d.response.data})})},updateShowDashboard(d,e){axios.post(route("user.report.set-default"),{user_id:this.user.id,report_id:d,state:e}).then(()=>{this.$swal({icon:"success",title:"Actualizado",text:"Reporte actualizado con exito",toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0}),R.visit(route("users.edit",this.user.id))}).catch(f=>{this.$swal({icon:"error",title:"ERROR",text:f.response.data})})}}},X={class:"flex flex-row"},Y={class:"font-semibold text-xl text-gray-800 leading-tight"},Z={class:"py-10"},ee={class:"max-w-8xl mx-10 sm:px-8 lg:px-8"},se={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},te={class:"py-2 align-middle inline-block min-w-full"},oe={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg bg-white p-5"},re={class:"grid grid-cols-3 gap-5"},le={key:0,class:"mt-1"},ie={key:0,class:"mt-1"},ne={key:0,class:"mt-1"},ae={class:"block"},de={class:"flex items-center"},me={key:0,class:"mt-1"},ue={key:0,class:"mt-1"},ce={class:"border rounded-lg p-4 col-span-3"},fe={class:"grid grid-cols-5 gap-5"},pe={class:"flex items-center"},_e={class:"ml-2"},he={key:0,class:"mt-1"},xe={class:"border rounded-lg p-4 col-span-3"},ge={class:"grid grid-cols-5 gap-5"},ve={class:"flex items-center"},we={class:"ml-2"},ke={key:0,class:"mt-1"},ye={class:"shadow overflow-hidden border-b border-gray-200 sm:rounded-lg mt-5 bg-white"},be={class:"min-w-full divide-y divide-gray-200"},Ce={class:"bg-gray-50"},Me={scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Re={class:"bg-white divide-y divide-gray-200"},Be={class:"px-6 py-4 text-center text-sm font-medium"},Ve={class:"flex flex-row"},Le={class:"px-6 py-4 text-left text-sm font-medium"},Ae={class:"px-6 py-4 text-left text-sm font-medium"},Ue={class:"px-6 py-4 text-left text-sm font-medium"},qe={key:1,class:"text-xs font-semibold inline-block py-1 px-2 rounded text-red-600 bg-red-200 uppercase last:mr-0 mr-1"},$e={key:1},ze={class:"grid grid-cols-2 gap-5"},Ie={class:"flex items-center"},Fe={class:"ml-2"},Ee={class:"grid grid-cols-2 gap-5"},Ne={class:"flex items-center"},Pe={class:"ml-2"};function Se(d,e,f,a,n,_){const B=h("font-awesome-icon"),q=h("Link"),k=h("InputLabel"),y=h("TextInput"),v=h("Checkbox"),V=h("PrimaryButton"),L=h("CustomButton"),A=h("SecondaryButton"),U=h("DialogModal"),$=h("AppLayout");return o(),j($,{title:`Editar usuario ${f.user.name}`},{header:m(()=>[t("div",X,[t("h2",Y," Editar usuario "+u(f.user.name),1)])]),actions:m(()=>[l(q,{href:d.route("users.index"),class:"inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150"},{default:m(()=>[l(B,{class:"mr-2",icon:"arrow-left"}),e[10]||(e[10]=x(" Atrás ",-1))]),_:1},8,["href"])]),default:m(()=>[t("div",Z,[t("div",ee,[t("div",se,[t("div",te,[t("div",oe,[t("div",re,[t("div",null,[l(k,{value:"Nombre"}),l(y,{modelValue:n.form.name,"onUpdate:modelValue":e[0]||(e[0]=s=>n.form.name=s),type:"text",class:w(["mt-1 block w-full",{"border-red-500":a.v$.form.name.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),a.v$.form.name.$error?(o(),r("ul",le,[(o(!0),r(c,null,p(a.v$.form.name.$errors,(s,i)=>(o(),r("li",{class:"text-red-500",key:i},u(s.$message),1))),128))])):g("",!0)]),t("div",null,[l(k,{value:"Usuario"}),l(y,{modelValue:n.form.username,"onUpdate:modelValue":e[1]||(e[1]=s=>n.form.username=s),type:"text",class:w(["mt-1 block w-full",{"border-red-500":a.v$.form.username.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),a.v$.form.username.$error?(o(),r("ul",ie,[(o(!0),r(c,null,p(a.v$.form.username.$errors,(s,i)=>(o(),r("li",{class:"text-red-500",key:i},u(s.$message),1))),128))])):g("",!0)]),t("div",null,[l(k,{value:"Correo electrónico"}),l(y,{modelValue:n.form.email,"onUpdate:modelValue":e[2]||(e[2]=s=>n.form.email=s),type:"email",class:w(["mt-1 block w-full",{"border-red-500":a.v$.form.email.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),a.v$.form.email.$error?(o(),r("ul",ne,[(o(!0),r(c,null,p(a.v$.form.email.$errors,(s,i)=>(o(),r("li",{class:"text-red-500",key:i},u(s.$message),1))),128))])):g("",!0)]),t("div",ae,[t("label",de,[l(v,{checked:n.form.change_password,"onUpdate:checked":e[3]||(e[3]=s=>n.form.change_password=s),name:"change_password"},null,8,["checked"]),e[11]||(e[11]=t("span",{class:"ml-2 text-sm text-gray-600"},"Cambiar contraseña",-1))])]),n.form.change_password?(o(),r(c,{key:0},[t("div",null,[l(k,{value:"Contraseña"}),l(y,{modelValue:n.form.password,"onUpdate:modelValue":e[4]||(e[4]=s=>n.form.password=s),type:"password",class:w(["mt-1 block w-full",{"border-red-500":a.v$.form.password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),a.v$.form.password.$error?(o(),r("ul",me,[(o(!0),r(c,null,p(a.v$.form.password.$errors,(s,i)=>(o(),r("li",{class:"text-red-500",key:i},u(s.$message),1))),128))])):g("",!0)]),t("div",null,[l(k,{value:"Confirmar Contraseña"}),l(y,{modelValue:n.form.confirm_password,"onUpdate:modelValue":e[5]||(e[5]=s=>n.form.confirm_password=s),type:"password",class:w(["mt-1 block w-full",{"border-red-500":a.v$.form.confirm_password.$error}]),required:"",autocomplete:"off"},null,8,["modelValue","class"]),a.v$.form.confirm_password.$error?(o(),r("ul",ue,[(o(!0),r(c,null,p(a.v$.form.confirm_password.$errors,(s,i)=>(o(),r("li",{class:"text-red-500",key:i},u(s.$message),1))),128))])):g("",!0)])],64)):g("",!0),t("fieldset",ce,[e[12]||(e[12]=t("legend",null,"Roles disponibles",-1)),t("div",fe,[(o(!0),r(c,null,p(f.roles,s=>(o(),r("div",pe,[l(v,{checked:n.form.roles,"onUpdate:checked":e[6]||(e[6]=i=>n.form.roles=i),value:s.name},null,8,["checked","value"]),t("div",_e,u(s.name),1)]))),256))]),a.v$.form.roles.$error?(o(),r("ul",he,[(o(!0),r(c,null,p(a.v$.form.roles.$errors,(s,i)=>(o(),r("li",{class:"text-red-500",key:i},u(s.$message),1))),128))])):g("",!0)]),t("fieldset",xe,[e[13]||(e[13]=t("legend",null,"Permisos disponibles",-1)),t("div",ge,[(o(!0),r(c,null,p(f.permissions,s=>(o(),r("div",ve,[l(v,{checked:n.form.permissions,"onUpdate:checked":e[7]||(e[7]=i=>n.form.permissions=i),value:s.name},null,8,["checked","value"]),t("div",we,u(s.name),1)]))),256))]),a.v$.form.permissions.$error?(o(),r("ul",ke,[(o(!0),r(c,null,p(a.v$.form.permissions.$errors,(s,i)=>(o(),r("li",{class:"text-red-500",key:i},u(s.$message),1))),128))])):g("",!0)])]),l(V,{onClick:_.updateUser,class:"mt-5"},{default:m(()=>[...e[14]||(e[14]=[x(" Actualizar ",-1)])]),_:1},8,["onClick"])]),t("div",ye,[t("table",be,[t("thead",Ce,[e[19]||(e[19]=t("tr",{class:"border-b"},[t("th",{scope:"col",colspan:"4",class:"px-6 py-3 text-left text-sm font-medium text-gray-500 uppercase tracking-wider"}," Reportes ")],-1)),t("tr",null,[t("th",Me,[l(L,{class:"mr-2",onClick:_.openReportModal},{default:m(()=>[l(B,{icon:["far","pen-to-square"],class:"mr-1"}),e[15]||(e[15]=x(" Modificar reportes ",-1))]),_:1},8,["onClick"])]),e[16]||(e[16]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Mostrar en dashboard ",-1)),e[17]||(e[17]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Reporte ",-1)),e[18]||(e[18]=t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Filtros ",-1))])]),t("tbody",Re,[f.user.reports.length>0?(o(!0),r(c,{key:0},p(f.user.reports,s=>(o(),r("tr",null,[t("td",Be,[t("div",Ve,[l(L,{class:"mr-2",onClick:i=>_.openFilterModal(s.id,s.filters)},{default:m(()=>[l(B,{icon:["fas","filter"],class:"mr-1"}),e[20]||(e[20]=x(" Filtros ",-1))]),_:1},8,["onClick"])])]),t("td",Le,[l(v,{onChange:i=>_.updateShowDashboard(s.id,!s.pivot.show),value:s.pivot.show,checked:s.pivot.show===1},null,8,["onChange","value","checked"])]),t("td",Ae,u(s.name),1),t("td",Ue,[s.filters.length>0?(o(!0),r(c,{key:0},p(s.filters,(i,z)=>(o(),r("span",{class:w(["text-xs font-semibold inline-block py-1 px-2 rounded text-green-600 bg-green-200 uppercase last:mr-0 mr-1",{"ml-1":z>0}])},u(i.name),3))),256)):(o(),r("span",qe," Ningún filtro agregado "))])]))),256)):(o(),r("tr",$e,[...e[21]||(e[21]=[t("td",{class:"px-6 py-4 text-sm font-medium text-center text-red-500",colspan:"4"}," Ningún registro agregado… ",-1)])]))])])])])])])]),l(U,{show:n.filterModal.open,onClose:_.closeModal},{title:m(()=>[x(" Filtros "+u(f.reports.find(s=>s.id===n.filterModal.form.report_id).name),1)]),content:m(()=>[t("div",ze,[(o(!0),r(c,null,p(f.filters,s=>(o(),r("div",Ie,[l(v,{checked:n.filterModal.form.filters,"onUpdate:checked":e[8]||(e[8]=i=>n.filterModal.form.filters=i),value:s.id},null,8,["checked","value"]),t("div",Fe,u(s.name),1)]))),256))])]),footer:m(()=>[l(A,{onClick:_.closeModal},{default:m(()=>[...e[22]||(e[22]=[x(" Cancelar ",-1)])]),_:1},8,["onClick"]),l(V,{class:"ml-3",onClick:_.updateFilter},{default:m(()=>[...e[23]||(e[23]=[x(" Actualizar ",-1)])]),_:1},8,["onClick"])]),_:1},8,["show","onClose"]),l(U,{show:n.reportModal.open,onClose:_.closeModal},{title:m(()=>[...e[24]||(e[24]=[x(" Modificar reportes ",-1)])]),content:m(()=>[t("div",Ee,[(o(!0),r(c,null,p(f.reports,s=>(o(),r("div",Ne,[l(v,{checked:n.reportModal.form.reports,"onUpdate:checked":e[9]||(e[9]=i=>n.reportModal.form.reports=i),value:s.id},null,8,["checked","value"]),t("div",Pe,u(s.name),1)]))),256))])]),footer:m(()=>[l(A,{onClick:_.closeModal},{default:m(()=>[...e[25]||(e[25]=[x(" Cancelar ",-1)])]),_:1},8,["onClick"]),l(V,{class:"ml-3",onClick:_.updateReports},{default:m(()=>[...e[26]||(e[26]=[x(" Actualizar ",-1)])]),_:1},8,["onClick"])]),_:1},8,["show","onClose"])]),_:1},8,["title"])}const Ye=D(W,[["render",Se]]);export{Ye as default};
